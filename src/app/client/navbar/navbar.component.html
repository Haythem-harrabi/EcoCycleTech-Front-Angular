<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&family=Oswald:wght@200..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<div class="navbar surface-overlay px-3 sm:px-7 flex flex-wrap align-items-stretch justify-content-between relative">
    <!-- Menu Hamburger (mobile) -->
    <a pRipple pStyleClass="#nav-2" enterClass="hidden" leaveToClass="hidden"
        class="p-ripple p-element cursor-pointer flex align-items-center lg:hidden text-700 mr-3">
        <i class="pi pi-bars text-4xl"></i>
        <span class="p-ink"></span>
    </a>
   
    <!-- Logo + Nom -->
    <div class="flex align-items-center justify-content-center py-3">
        <img id="logo" src="../../../assets/img/logo.png" alt="EcoCycleTech Logo">
        <span id="CompanyName">EcoCycleTech</span>
    </div>
    
    <!-- Menu Principal -->
    <div id="nav-2" class="surface-overlay hidden lg:flex absolute lg:static left-0 top-100 z-1 shadow-2 lg:shadow-none w-full lg:w-auto py-3 lg:py-0">
        <ul class="list-none p-0 m-0 flex flex-column lg:flex-row">
            <!-- Products -->
            <li class="nav-element flex flex-column lg:flex-row">
                <a (click)="SetActive($event)" pRipple pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                    class="p-ripple p-element font-medium inline-flex align-items-center cursor-pointer border-left-2 lg:border-left-none border-transparent hover:border-primary py-3 lg:py-0 px-6 lg:px-3 text-700 select-none text-xl lg:text-base lg:font-base w-full lg:w-auto">
                    <span>Products</span>
                    <span class="p-ink"></span>
                </a>
                <div class="dropdown-menu products-menu shadow-none lg:shadow-2 lg:absolute w-full left-0 top-100 pl-8 pr-6 lg:px-6 py-0 lg:py-6 hidden">
                    <!-- Contenu existant -->
                </div>
            </li>
            
            <!-- Recycling -->
            <li class="nav-element flex flex-column lg:flex-row">
                <a (click)="SetActive($event)" pRipple pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                    class="p-ripple p-element font-medium inline-flex align-items-center cursor-pointer border-left-2 lg:border-left-none border-transparent hover:border-primary py-3 lg:py-0 px-6 lg:px-3 text-700 select-none text-xl lg:text-base lg:font-base w-full lg:w-auto">
                    <span>Recycling</span>
                    <span class="p-ink"></span>
                </a>
                <div class="dropdown-menu surface-overlay shadow-none lg:shadow-2 lg:absolute w-full top-100 h-10rem lg:h-30rem z-1 hidden">
                    <div class="content">
                        <div class="content-element"> <span>Recycle device</span></div>
                        <div class="content-element"> <span>Repair device</span></div>
                    </div>
                </div>
            </li>
            
            <!-- Events -->
            <li class="nav-element flex flex-column lg:flex-row">
                <a (click)="SetActive($event)" pRipple pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                    class="p-ripple p-element font-medium inline-flex align-items-center cursor-pointer border-left-2 lg:border-left-none border-transparent hover:border-primary py-3 lg:py-0 px-6 lg:px-3 text-700 select-none text-xl lg:text-base lg:font-base w-full lg:w-auto">
                    <span>Events</span>
                    <span class="p-ink"></span>
                </a>
            </li>
            
            <!-- Eco-Drive -->
            <li class="nav-element flex flex-column lg:flex-row">
                <a (click)="SetActive($event)" pRipple pStyleClass="@next" enterClass="hidden" leaveToClass="hidden"
                    class="p-ripple p-element font-medium inline-flex align-items-center cursor-pointer border-left-2 lg:border-left-none border-transparent hover:border-primary py-3 lg:py-0 px-6 lg:px-3 text-700 select-none text-xl lg:text-base lg:font-base w-full lg:w-auto">
                    <span>Eco-Drive</span>
                    <span class="p-ink"></span>
                </a>
                <div class="dropdown-menu surface-overlay lg:shadow-2 lg:absolute w-full top-100 px-6 py-0 lg:py-6 h-10rem lg:h-30rem z-1 hidden">
                    <div class="content">
                        <div class="content-element"> <span>Buy a storage plan</span></div>
                        <div class="content-element"> <span>View my space</span></div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
   
    <!-- Section Droite (Icônes + User) -->
    <div class="lg:flex w-full lg:w-auto hidden py-3 lg:py-0">
        <ul class="list-none p-0 m-0 flex w-full" style="min-height: 30px;">
            <!-- Search -->
            <li class="flex flex-auto lg:flex-initial justify-content-center">
                <a pRipple class="nav-icon p-ripple p-element text-900 font-medium inline-flex align-items-center cursor-pointer lg:pr-3 text-700 hover:text-primary">
                    <i class="pi pi-search text-xl"></i>
                    <span class="hidden">Search</span>
                    <span class="p-ink"></span>
                </a>
            </li>
            
            <!-- Favorites -->
            <li class="flex flex-auto lg:flex-initial justify-content-center">
                <a pRipple class="nav-icon p-ripple p-element text-900 font-medium inline-flex align-items-center cursor-pointer lg:px-3 text-700 hover:text-primary">
                    <i class="pi pi-heart text-xl"></i>
                    <span class="hidden">Favorites</span>
                    <span class="p-ink"></span>
                </a>
            </li>
            
            <!-- User Menu (Version améliorée) -->
            <li class="user-menu-container flex flex-auto lg:flex-initial justify-content-center">
                <div *ngIf="!authService.isAuthenticated()">
                    <a routerLink="/login" class="login-btn">
                        <i class="pi pi-user"></i>
                        <span class="login-text">Sign In</span>
                    </a>
                </div>
                
                <div *ngIf="authService.isAuthenticated()" class="user-menu-wrapper">
                    <div class="user-trigger" 
                         (click)="toggleUserMenu()"
                         (mouseleave)="showUserMenu(false)">
                         
                        <div class="user-avatar-wrapper">
                            <img [src]="currentUser?.photoDeProfil || defaultAvatar"
                                 (error)="handleImageError($event)"
                                 class="user-avatar-img" alt="User profile">
                            <!-- red dot on avatar -->
                            <div *ngIf="notifCount" class="notification-dot"></div>
                          </div>
                        <span class="user-name">{{ getUserDisplayName() }}</span>
                        <i class="dropdown-icon bi bi-chevron-down"></i>
                    </div>
                    
                    <div class="user-dropdown-panel" 
                         [class.active]="isUserMenuVisible"
                         (mouseenter)="showUserMenu(true)"
                         (mouseleave)="showUserMenu(false)">
                         
                        <div class="user-panel-header">
                            <img [src]="currentUser?.photoDeProfil || defaultAvatar"
                            (error)="handleImageError($event)"
                            class="panel-avatar">
                            <div class="user-meta">
                                <div class="user-display-name">{{currentUser?.prenom}} {{currentUser?.nom}}</div>
                                <div class="user-email">{{currentUser?.email}}</div>
                            </div>
                        </div>
                        
                        <div class="panel-divider"></div>
                        
                        <a routerLink="/user-profile" class="panel-item">
                            <i class="bi bi-person"></i>
                            <span>My Profile</span>
                        </a>
                        
                        <a routerLink="/settings" class="panel-item">
                            <i class="bi bi-gear"></i>
                            <span>Settings</span>
                        </a>
                        
                        <a routerLink="/notifications"
                        class="panel-item notification-item">
                         <i class="bi bi-bell"></i>
                        <span>Notifications</span>

                        <!-- pastille compteur -->
                        <span *ngIf="notifCount"
                          class="notification-bubble">
                            {{ notifCount }}
                        </span>
                        </a>
                        <!-- 2️⃣  Aperçu des notifications directement dans le menu -->
<ul *ngIf="notifs.length"
class="mt-2 space-y-2 max-h-40 overflow-y-auto">

<li *ngFor="let n of notifs"
   class="px-3 py-2 rounded bg-slate-50
          flex justify-between items-start text-sm">

    <div class="pr-2">
        <div class="font-medium">{{ n.label }}</div>
        <div class="text-gray-600"
             [innerHTML]="n.body"></div>
    </div>

    <button class="text-xs px-1.5 py-0.5 rounded
                   bg-emerald-600 text-white
                   hover:bg-emerald-700"
            (click)="markAsRead(n)">
       OK
    </button>
</li>

</ul>

<div *ngIf="notifs.length" class="panel-divider"></div>

                        
                        <div *ngIf="isAdmin()">
                            <div class="panel-divider"></div>
                            <a routerLink="/admin" class="panel-item">
                                <i class="bi bi-shield-lock"></i>
                                <span>Admin Dashboard</span>
                            </a>
                        </div>
                        
                        <div class="panel-divider"></div>
                        
                        <a (click)="logout()" class="panel-item logout-action">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Sign Out</span>
                        </a>
                    </div>
                </div>
            </li>
            
            <!-- Cart -->
            <li class="flex flex-auto lg:flex-initial justify-content-center">
                <a pRipple pStyleClass="@next" enterClass="hidden" enterActiveClass="scalein" leaveToClass="hidden"
                    leaveActiveClass="fadeout"
                    class="nav-icon p-ripple p-element text-900 font-medium inline-flex align-items-center cursor-pointer px-1 lg:px-3 hover:text-primary">
                    <i pbadge="" class="p-element pi pi-shopping-cart text-xl p-overlay-badge">
                        <span id="pr_id_9_badge" class="p-badge p-component p-badge-dot"></span>
                    </i>
                    <span class="hidden">My Cart</span>
                    <span class="p-ink"></span>
                </a>
                <div class="border-round surface-overlay p-4 shadow-2 absolute right-0 top-100 z-1 w-20rem origin-top hidden">
                    <!-- Cart dropdown content remains the same -->
                </div>
            </li>
        </ul>
    </div>
</div>

<!-- Mobile Navigation -->
<div class="mobile-nav flex w-full lg:w-auto border-y-1 surface-border surface-overlay lg:hidden py-3 lg:py-0">
    <ul class="list-none p-0 m-0 flex w-full" style="min-height: 30px;">
        <!-- Icônes mobiles... -->
    </ul>
</div>